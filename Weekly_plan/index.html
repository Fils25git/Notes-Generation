<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fila Assistant - CBC Weekly plan Generator</title>
    <meta property="og:type" content="website" />
<meta property="og:title" content="Fila Assistant" />
<meta property="og:description" content=" Fila Assistant is an educational website that offers a wide range of educational resources, including Lesson Plans, and study guides for teachers and students across primary and secondary education" />
<meta property="og:image" content="https://www.fleduacademy.com/../logo.png" />
<meta property="og:url" content="https://www.fleduacademy.com" />
    
    <link rel="stylesheet" href="plans.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

    <style>
        .profile-icon {
    font-size:28px; color:#4f46e5; cursor:pointer;
}
        Responsive footer */
  footer {
    margin-top: 20px;
    text-align: center;
    font-size: 14px;
    color: #fff;
    width: 100%;
  }
  footer a {
    color: #fff;
    text-decoration: underline;
    margin: 0 5px;
      }
      
        body{
            background: linear-gradient(135deg, #6dd5fa, #2980b9);
        }
      .floating-message {
        position: fixed;
        bottom: 30px;
        right: 30px;
        background: #e74c3c;
        color: #fff;
        padding: 18px 22px;
        border-radius: 14px;
        box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        display: none;
        z-index: 9999;
        animation: slideIn 0.6s ease;
        max-width: 300px;
        line-height: 1.6;
      }
        #lessonPlanContent[contenteditable="true"] {
    border: 2px dashed #007bff;
    background: #f8fbff;
    padding: 15px;
        }

      @keyframes slideIn {
        from { transform: translateY(30px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
      }

      .floating-message a {
        color: #fff;
        text-decoration: underline;
        font-weight: bold;
      }
    </style>
</head>
<body>

<div class="container">
    <!-- Header -->
  <div class="header">
    <div class="header-left">
        <img src="../logo.png">
        <h2>Fila Assistant</h2>
    </div>

    <!-- Profile Icon (fixed right) -->
    <i id="profileIcon"
       class="fas fa-user-circle profile-icon"
       onclick="go('../profile.html')"
       title="My Profile">
    </i>
</div>
   
    <!-- Form -->
    <div class="form-container">
        <p><b>Fill in the required fields below To Fetch Weekly Plan</b></p><br>
        
<form id="lessonForm">
<div class="form-grid">

<h3>ğŸ“Œ General Information</h3>

    <div class="form-group">
                    <label class="required">School Name</label>
                    <input type="text" id="schoolName" placeholder="e.g:,TTC BICUMBI"  required>
    </div>

    <div class="form-group">
                    <label class="required">Teacher's Name</label>
                    <input type="text" id="teacherName" placeholder="e.g:, IRATURINZE Fils Lambert" required>
    </div>
    
                <div class="form-group">
<label class="required">Date</label>
<input type="date" id="date" required>
                </div>
    
                <div class="form-group">
<label class="required">Term</label>
<select id="term" required>
  <option value="">Select term</option>
  <option value="I">Term I</option>
  <option value="II">Term II</option>
  <option value="III">Term III</option>
</select>
                </div>
    
                <div class="form-group">
<label class="required" class="required">Level</label>
<input type="text" id="level" placeholder="e.g. N1, N3A" required>
                </div>
    
                <div class="form-group">
<label class="required">Academic Year</label>
<input type="text" id="year" placeholder="e.g. 2025-2026" required>
                </div>
    
                <div class="form-group">
<label class="required">Number of Children</label>
<input type="number" id="childrensNumber" required>
                </div>
    
                <div class="form-group">

<label class="required">Insanganyamatsiko nini (Kinyarwanda)</label>
<input type="text" id="mainTopic" required>
                </div>
    
                <div class="form-group">

    <label class="required">Insanganyamatsiko nini (in English)</label>
                
<input type="text" id="mainTopic" required>
                    </div>
    
                <div class="form-group">
<label class="required">Insanganyamatsiko nto ( mu Kinyarwanda)</label>
                
<input type="text" id="subTopic" required>
                </div>

                <div class="form-group">
<label class="required">Insanganyamatsiko nto ( in English)</label>
<input type="text" id="subTopicEng" required>
                </div>

                <div class="form-group full-width">
<label class="optional">Special Educational Needs (If available)</label>
<input type="text" id="specialNeeds" placeholder="Optional">
                </div>

<hr>

<h3>ğŸ•¢ 7:45 â€“ 8:00 | Guhana ikaze</h3>
    
    <div class="form-group">
<label class="required">Ikigwa</label>
        <div class="form-group">
<input type="text" id="ikigwa_0745" required>
<label class="required">Ibindi byigwa</label>
<input type="text" id="ibindi_byigwa_0745" required>
        </div>
    </div>

<h3>ğŸ•— 8:00 â€“ 8:30 | Imibare</h3>
    <div class="form-group">
<label class="required">Ikigwa</label>
        <div class="form-group">
<input type="text" id="ikigwa_0800" required>
<label class="required">Ibindi byigwa</label>
<input type="text" id="ibindi_byigwa_0800" required>
        </div>
    </div>

<h3>ğŸ•£ 8:30 â€“ 9:00 | Ubumenyi bw'Ibidukikije</h3>
    <div class="form-group">
<label class="required">Ikigwa</label>
        <div class="form-group">
<input type="text" id="ikigwa_0830" required>
<label class="required">Ibindi byigwa</label>
<input type="text" id="ibindi_byigwa_0830" required>
        </div>
    </div>

<h3>ğŸ•˜ 9:00 â€“ 9:30 | Ikinyarwanda</h3>
    <div class="form-group">
<label class="required">Ikigwa</label>
      <div class="form-group">  
<input type="text" id="ikigwa_0900" required>
<label class="required">Ibindi byigwa</label>
<input type="text" id="ibindi_byigwa_0900" required>
        </div>
    </div>
<h3>ğŸ•¤ 9:30 â€“ 10:00 | English Oral Communication</h3>
    <div class="form-group">
<label class="required">Ikigwa</label>
        <div class="form-group">
<input type="text" id="ikigwa_0930" required>
<label class="required">Ibindi byigwa</label>
<input type="text" id="ibindi_byigwa_0930" required>
        </div>
    </div>
<h3>ğŸ•¥ 10:40 â€“ 11:00 | I imikino yo hanze</h3>
    <div class="form-group">
<label class="required">Ikigwa</label>
        <div class="form-group">
<input type="text" id="ikigwa_1040" required>
<label class="required">Ibindi byigwa</label>
<input type="text" id="ibindi_byigwa_1040" required>
        </div>
    </div>

<h3>ğŸ•š 11:00 â€“ 11:20 | Ubugeni n'umuco</h3>
    <div class="form-group">
<label class="required">Ikigwa</label>
        <div class="form-group">
<input type="text" id="ikigwa_1100" required>
<label class="required">Ibindi byigwa</label>
<input type="text" id="ibindi_byigwa_1100" required>
        </div>
    </div>

<h3>ğŸ•¦ 11:20 â€“ 11:40 | Indoor Games</h3>
    <div class="form-group">
<label class="required">Ikigwa</label>
        <div class="form-group">
<input type="text" id="ikigwa_1120" required>
<label class="required">Ibindi byigwa</label>
<input type="text" id="ibindi_byigwa_1120" required>
        </div>
    </div>

<h3>ğŸ•› 11:40 â€“ 12:00 | Closing Time</h3>
    <div class="form-group">
<label class="required">Ikigwa</label>
    <div class="form-group">
<input type="text" id="ikigwa_1140" required>
<label class="required">Ibindi byigwa</label>
<input type="text" id="ibindi_byigwa_1140" required>
        </div>
    </div>

<hr>

<button type="submit" class="generate-btn">Generate Weekly Plan</button>
    <div id="errorMessage" class="error-message"></div>

</form>
    </div>

    <!-- Result -->
    <div id="resultContainer" class="result-container">
        <div class="download-buttons">
            <button class="download-btn btn-word" onclick="copyToWord()">ğŸ“„ Copy to Word</button>
            <button class="download-btn btn-pdf" onclick="window.print()">ğŸ“‘ Save as PDF/Print</button>
    <button id="editBtn" Class="download-btn">âœï¸ Edit</button>
    <button id="saveBtn" class="download-btn" disabled>ğŸ’¾ Save</button>
            
        </div>
        <div id="lessonPlanContent" class="lesson-plan"></div>
        
    </div>
</div>

<div id="floatingMessage" class="floating-message"></div>


<!-- Netlify Identity -->
<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <script>
/* ===============================
   AUTH CHECK (UNCHANGED)
================================ */
const token = localStorage.getItem("auth_token");
const userEmail = localStorage.getItem("user_email");

if (!token || !userEmail) {
  window.location.href = "../login.html";
}

/* ===============================
   FLOATING MESSAGE
================================ */
function showFloatingMessage(msg) {
  const box = document.getElementById("floatingMessage");
  box.innerHTML = msg;
  box.style.display = "block";
  setTimeout(() => box.style.display = "none", 6000);
}

/* ===============================
   FORM SUBMIT
================================ */
document
  .getElementById("weeklyPlanForm")
  .addEventListener("submit", function (e) {
    e.preventDefault();
    generateWeeklyPlan();
  });

/* ===============================
   GENERATE WEEKLY PLAN
================================ */
function generateWeeklyPlan() {
  const data = {
    schoolName: schoolName.value,
   teacherName: teacherName.value,
    date: date.value,
    term: term.value,
    level: level.value,
    year: year.value,
    childrensNumber: childrensNumber.value,
    mainTopic: mainTopic.value,
    subTopic: subTopic.value,
    subTopicEng: subTopicEng.value,
    specialNeeds: specialNeeds.value || "Nta bibazo byihariye byagaragaye",

    ikigwa_0745: ikigwa_0745.value,
    ibindi_byigwa_0745: ibindi_byigwa_0745.value,

    ikigwa_0800: ikigwa_0800.value,
    ibindi_byigwa_0800: ibindi_byigwa_0800.value,

    ikigwa_0830: ikigwa_0830.value,
    ibindi_byigwa_0830: ibindi_byigwa_0830.value,

    ikigwa_0900: ikigwa_0900.value,
    ibindi_byigwa_0900: ibindi_byigwa_0900.value,

    ikigwa_0930: ikigwa_0930.value,
    ibindi_byigwa_0930: ibindi_byigwa_0930.value,

    ikigwa_1040: ikigwa_1040.value,
    ibindi_byigwa_1040: ibindi_byigwa_1040.value,

    ikigwa_1100: ikigwa_1100.value,
    ibindi_byigwa_1100: ibindi_byigwa_1100.value,

    ikigwa_1120: ikigwa_1120.value,
    ibindi_byigwa_1120: ibindi_byigwa_1120.value,

    ikigwa_1140: ikigwa_1140.value,
    ibindi_byigwa_1140: ibindi_byigwa_1140.value
  };

  fetch("weekly_schedule_template.html")
    .then(res => res.text())
    .then(template => {
      for (const key in data) {
        template = template.replace(
          new RegExp(`{{\\s*${key}\\s*}}`, "g"),
          data[key]
        );
      }

      lessonPlanContent.innerHTML = template;
      resultContainer.classList.add("show");
      resultContainer.scrollIntoView({ behavior: "smooth" });

      autoSaveWeeklyPlan(template);
    })
    .catch(() => {
      showFloatingMessage("âŒ Failed to load weekly schedule template.");
    });
}

/* ===============================
   AUTO SAVE (OPTIONAL BUT READY)
================================ */
async function autoSaveWeeklyPlan(content) {
  try {
    await fetch("/.netlify/functions/create-user-plan", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        email: userEmail,
        lesson_title: "CBC Weekly Schedule",
        lesson_content: content,
        language: "kinyarwanda"
      })
    });
  } catch (err) {
    console.error("Auto-save failed", err);
  }
}

/* ===============================
   EDIT & COPY (UNCHANGED)
================================ */
editBtn.addEventListener("click", () => {
  lessonPlanContent.contentEditable = true;
  editBtn.disabled = true;
  saveBtn.disabled = false;
});

saveBtn.addEventListener("click", () => {
  lessonPlanContent.contentEditable = false;
  editBtn.disabled = false;
  saveBtn.disabled = true;
});

function copyToWord() {
  const range = document.createRange();
  range.selectNode(lessonPlanContent);
  window.getSelection().removeAllRanges();
  window.getSelection().addRange(range);
  document.execCommand("copy");
  window.getSelection().removeAllRanges();
  showFloatingMessage("âœ… Weekly plan copied.");
}

function go(path) {
  window.location.href = path;
}
             </script>

</body>
    </html>
