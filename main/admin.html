<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fila Assistant - Admin</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link rel="stylesheet" href="css/style.css">
<style>
  body { font-family:sans-serif; background:#f4f6f8; padding:20px; }
  h1 { margin-bottom:10px; }
  input[type="text"] { padding:8px; width:300px; margin-bottom:10px; border-radius:5px; border:1px solid #ccc; }
  table { width:100%; border-collapse:collapse; margin-top:10px; }
  th, td { border:1px solid #ddd; padding:8px; text-align:left; }
  th { background:#2980b9; color:#fff; }
  .btn { padding:5px 10px; border:none; border-radius:5px; cursor:pointer; }
  .action-buttons {
  display: flex;
  gap: 8px;          /* space between buttons */
  justify-content: center; /* center in the table cell */
  align-items: center;
}

.btn {
  border: none;
  padding: 6px 10px;
  cursor: pointer;
  border-radius: 5px;
  font-size: 16px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}
  ..btn {
  border: none;
  padding: 6px 10px;
  cursor: pointer;
  border-radius: 5px;
  font-size: 16px;
}

.btn-view {
  background: #3498db;
  color: white;
}

.btn-delete {
  background: #e74c3c;
  color: white;
    }
  .toast { position: fixed; top:20px; right:20px; background:#4caf50; color:#fff; padding:10px 20px; border-radius:5px; box-shadow:0 2px 5px rgba(0,0,0,0.2); opacity:0; transition:0.3s; z-index:9999; }
  .toast.show { opacity:1; }
</style>
</head>
  <script>
const ADMIN_EMAIL = "iraturinze02@gmail.com"; // üî¥ PUT YOUR REAL EMAIL HERE

const isLoggedIn = localStorage.getItem("isLoggedIn") === "true";
const email = localStorage.getItem("user_email");

// 1Ô∏è‚É£ Not logged in ‚Üí go to login
if (!isLoggedIn) {
    localStorage.setItem("redirectAfterLogin", "admin.html");
    window.location.replace("login.html");
}

// 2Ô∏è‚É£ Logged in but NOT admin ‚Üí kick out
if (email !== ADMIN_EMAIL) {
    alert("Access denied. Admin only.");
    window.location.replace("index.html");
}
  </script>
<body>

<h1>Admin Dashboard</h1>

<!-- Search -->
<div style="display:flex; gap:10px; align-items:center; margin-bottom:10px;">
  <input type="text" id="searchInput" placeholder="Search by name, email, or phone">
  <button class="btn btn-view" onclick="goToPayments()">Payments</button>
</div>

<table id="usersTable">
  <thead>
    <tr>
      <th>#</th>
      <th>Name</th>
      <th>Email</th>
      <th>Phone</th>
      <th>Balance</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <tr><td colspan="5">Loading users...</td></tr>
  </tbody>
</table>
  <div id="pagination" style="margin-top:15px;text-align:center;"></div>

<!-- Toast -->
<div id="toast" class="toast"></div>

<script>
  function goToPayments() {
  window.location.href = "ad-payments.html";
  }
const usersTableBody = document.querySelector("#usersTable tbody");
const searchInput = document.getElementById("searchInput");
const toast = document.getElementById("toast");

let usersData = []; // store users for search filtering

function showToast(message, success = true) {
  toast.textContent = message;
  toast.style.background = success ? "#4caf50" : "#e74c3c";
  toast.classList.add("show");
  setTimeout(() => toast.classList.remove("show"), 3000);
}

// Fetch all users
let currentPage = 1;
let totalPages = 1;
const limit = 50;

async function fetchUsers(page = 1, search = "") {
  try {
    const res = await fetch(
      `/.netlify/functions/get-users?page=${page}&limit=50&search=${encodeURIComponent(search)}`
    );

    const data = await res.json();

    usersData = data.users;
    currentPage = data.currentPage;
    totalPages = data.totalPages;

    renderUsers(usersData);
    renderPagination(search);

  } catch (err) {
    console.error(err);
  }
}
// Render users to table

function renderUsers(users) {
  if (!users.length) {
    usersTableBody.innerHTML = `<tr><td colspan="6">No users found.</td></tr>`;
    return;
  }

  usersTableBody.innerHTML = "";

  users.forEach((user, index) => {
    const row = document.createElement("tr");

    row.innerHTML = `
  <td>${index + 1}</td>
  <td>${user.name}</td>
  <td>${user.email}</td>
  <td>${user.phone || "N/A"}</td>
  <td>${user.balance || 0}</td>
  <td class="action-buttons">>
    <button class="btn btn-view" onclick="viewPayments('${user.id}')" title="View Payments">
      <i class="fas fa-eye"></i>
    </button>

    <button class="btn btn-delete" onclick="deleteUser('${user.id}', this)" title="Delete User">
      <i class="fas fa-trash"></i>
    </button>
  </td>
`;

    usersTableBody.appendChild(row);
  });
                            }

// Search filter

searchInput.addEventListener("input", () => {
  const term = searchInput.value.trim();
  fetchUsers(1, term); // Always go back to page 1 when searching
});
// Delete user
async function deleteUser(userId, btn) {
  if (!confirm("Are you sure you want to delete this user?")) return;
  try {
    const res = await fetch(`/.netlify/functions/delete-user?id=${userId}`, {
      method: "DELETE"
    });
    if (!res.ok) throw new Error("Failed to delete user");
    btn.closest("tr").remove();
    usersData = usersData.filter(u => u.id !== userId);
    showToast("User deleted successfully");
  } catch(err) {
    console.error(err);
    showToast(err.message, false);
  }
}
  function renderPagination(search = "") {
  const container = document.getElementById("pagination");
  container.innerHTML = "";

  if (totalPages <= 1) return;

  const prev = document.createElement("button");
  prev.textContent = "‚¨Ö Prev";
  prev.className = "btn";
  prev.disabled = currentPage === 1;
  prev.onclick = () => fetchUsers(currentPage - 1, search);

  const next = document.createElement("button");
  next.textContent = "Next ‚û°";
  next.className = "btn";
  next.disabled = currentPage === totalPages;
  next.onclick = () => fetchUsers(currentPage + 1, search);

  const info = document.createElement("span");
  info.style.margin = "0 10px";
  info.textContent = `Page ${currentPage} of ${totalPages}`;

  container.append(prev, info, next);
  }

// View Payments (optional)
function viewPayments(userId) {
  window.location.href = `payments.html?user=${userId}`;
}
  

// Initial load
fetchUsers(1);
</script>

</body>
  </html>
